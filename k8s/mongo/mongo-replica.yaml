apiVersion: mongodbcommunity.mongodb.com/v1
kind: MongoDBCommunity
metadata:
    name: mongodb-rs
spec:
    members: 2
    type: ReplicaSet
    version: '4.2.6'
    security:
        authentication:
            modes: ['SCRAM']
    users:
        - name: user
          db: app
          passwordSecretRef: # a reference to the secret that will be used to generate the user's password
              name: user-password
          roles:
              - name: clusterAdmin
                db: admin
              - name: dbAdminAnyDatabase
                db: admin
              - name: readWriteAnyDatabase
                db: admin
              - name: userAdminAnyDatabase
                db: admin
          scramCredentialsSecretName: my-scram
    additionalMongodConfig:
        storage.wiredTiger.engineConfig.journalCompressor: zlib

# the user credentials will be generated from this secret
# once the credentials are generated, this secret is no longer required
---
apiVersion: v1
kind: Secret
metadata:
    name: user-password
type: Opaque
stringData:
    password: root
